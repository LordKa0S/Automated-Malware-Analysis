#! /usr/bin/python
import vboxapi
import logging
import VBinit
virtualBoxManager = vboxapi.VirtualBoxManager(None, None)
vbox = virtualBoxManager.getVirtualBox()
vboxVMList = virtualBoxManager.getArray(vbox, 'machines')
logging.basicConfig(format='%(levelname)s:\t%(message)s', level=logging.DEBUG)


def schedule():
    for vm in vboxVMList:
        if vm.name != "AMA":
            continue
        mach = vbox.findMachine(vm.name)
        # if mach.sessionState is virtualBoxManager.constants.SessionState_Unlocked:
        VBinit.proc(mach, virtualBoxManager, vbox)
        break
    else:
        logging.info("All the machines are busy.")


if __name__ == "__main__":
    schedule()
