import vboxapi
import logging
import VBinit
virtualBoxManager = vboxapi.VirtualBoxManager(None, None)
vbox = virtualBoxManager.getVirtualBox()
vboxVMList = virtualBoxManager.getArray(vbox, 'machines')
vboxNameList = [mach.name for mach in vboxVMList]
logging.basicConfig(format='%(levelname)s:\t%(message)s', level=logging.DEBUG)

#print vboxNameList
for MACH_NAME in vboxNameList:
    mach = vbox.findMachine(MACH_NAME)
    if mach.sessionState is virtualBoxManager.constants.SessionState_Unlocked:
        VBinit.proc(mach)
else:
    logging.info("All the machines are busy.")
