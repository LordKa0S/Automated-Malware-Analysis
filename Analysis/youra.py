import yara
from os import listdir, getcwd
from os.path import normpath, join

RULE_DIR = r'C:\Users\HOME\Downloads\rules'
FILE_TO_SCAN = r'C:\Users\HOME\Downloads\file.txt'
rulefiles = listdir(RULE_DIR)
address = {'namespace '+str(i): normpath(join(RULE_DIR,
                                              rulefiles[i])) for i in range(0, len(rulefiles))}
rules = yara.compile(filepaths=address)
rules.save(normpath(join(getcwd(), 'my_compiled_rules')))
rules = yara.load(normpath(join(getcwd(), 'my_compiled_rules')))


def mycallback(data):
    print data['rule']
    return yara.CALLBACK_CONTINUE


matches = rules.match(FILE_TO_SCAN, callback=mycallback,
                      which_callbacks=yara.CALLBACK_MATCHES)
