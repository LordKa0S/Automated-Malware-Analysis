import requests


class Virustotal:
    api_key = '61954dc66dc3e45ab6030951c2fbf57c4e3e798901c9fe6606b6bff2d41d30ea'

    def upload_sample(self, file_details):
        url = 'https://www.virustotal.com/vtapi/v2/file/scan'
        params = {'apikey': self.api_key}
        # Sample location can be shared
        files = {'file': (file_details['filename'], open(file_details['filepath'], 'rb'))}
        response = requests.post(url, files=files, params=params)
        data = response.json()
        sha256 = data['sha256']
        result = self._get_sample_report(resource=sha256)

        print "Virustotal Score: " + result['positives']/result['total']

    def _get_sample_report(self, resource):
        url = 'https://www.virustotal.com/vtapi/v2/file/report'
        params = {'apikey': self.api_key, 'resource': resource}
        response = requests.get(url, params=params)
        data = response.json()

        return data

vtotObj = Virustotal()
file_details = {'filepath': r'C:\Users\shantanu.vichare\PycharmProjects\Sandbox\resources\FirefoxInstaller.exe',
          'filename':'FirefoxInstaller.exe'}
vtotObj.upload_sample(file_details)
